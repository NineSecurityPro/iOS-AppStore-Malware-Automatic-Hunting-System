/**
 * Copyright (c) 2017 moony li of @Flyic.
 *2017-05-27

 2017-07-17 implementation
**/


'use strict';

String.prototype.format = function() {
    var formatted = this;
    for( var arg in arguments ) {
        formatted = formatted.replace("{" + arg + "}", arguments[arg]);
    }
    return formatted;
};

function readCString(allocatedBuffer, allocatedBufferSize)
{
    

    //var allocatedBufferSize = 256;
    //var allocatedBuffer = Memory.alloc(allocatedBufferSize);
    var retStr = "";
    
    var varStrTemp =  Memory.readCString(allocatedBuffer, allocatedBufferSize);

    //var varBytes = Memory.readByteArray(allocatedBuffer, allocatedBufferSize);
    //var dumpBuf = hexdump(varBytes, {
    //      offset: 0,
    //      length: allocatedBufferSize,
    //      header: false,
    //      ansi: false
    //    });
    retStr = varStrTemp;
    
    //consoleLog("readCString:\tdumpBuf:\r\n"+dumpBuf);
    var index = 0;
    
    for (;index<allocatedBufferSize;index++)
    {
        var value = varStrTemp.charCodeAt(index);//varBytes[index];
        //consoleLog("readCString:\t[{0}]={1}\r\n".format(index, value));
        if (value == 65533 || value == 0)//0xFFFD
        {
            break;
        }
    }
    //consoleLog("readCString:\tindex:\r\n"+index);
  
    if (index >= 0)
    {
        retStr = varStrTemp.substring(0, index);
    }
    
    //consoleLog("readCString:\treturn:\t"+retStr);
    return retStr;


}


 